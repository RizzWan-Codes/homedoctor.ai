<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard - Homedoctor.ai</title>
  <link rel="icon" href="hello.png">
  <style>
    /* Reset & Base */
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif; }
    body { background: #f9fdfb; color: #222; line-height: 1.6; overflow-x: hidden; }

    /* Header */
    header {
      position: fixed; top: 0; left: 0; width: 100%;
      padding: 1rem 2rem; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);
      display: flex; justify-content: space-between; align-items: center; z-index: 1000;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    header .logo { font-size: 1.5rem; font-weight: 700; color: #1b9c85; }
    nav { display: flex; gap: 1.5rem; }
    nav a { text-decoration: none; color: #333; font-weight: 500; transition: color 0.3s; }
    nav a:hover { color: #1b9c85; }
    .menu-toggle { display: none; font-size: 1.8rem; cursor: pointer; }
    @media (max-width: 768px) {
      nav { display: none; flex-direction: column; background: white; position: absolute; top: 60px; right: 20px; padding: 1rem; box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1); border-radius: 10px; }
      nav.active { display: flex; }
      .menu-toggle { display: block; }
    }

    /* Hero */
    .hero {
      min-height: 60vh;
      background: linear-gradient(135deg, #d9f9f2, #f9fdfb);
      display: flex; align-items: center; justify-content: center;
      padding: 8rem 2rem 2rem; text-align: center;
    }
    .hero h1 { font-size: 2.5rem; font-weight: 800; color: #145c4f; margin-bottom: 1rem; }
    .hero p { font-size: 1.2rem; max-width: 650px; margin: 0 auto; color: #444; }

    /* Coins Section */
    .coins { padding: 4rem 2rem; background: white; text-align: center; }
    .coins h2 { font-size: 2rem; margin-bottom: 1rem; color: #145c4f; }
    .coins p { font-size: 1.1rem; margin-bottom: 2rem; }
    .generate-btn {
      padding: 1rem 2.5rem; background: #1b9c85; color: white; border: none; border-radius: 30px;
      font-size: 1.1rem; cursor: pointer; transition: background 0.3s;
    }
    .generate-btn:hover { background: #167b68; }
    .generate-btn:disabled { background: gray; cursor: not-allowed; }

    /* Hidden Form */
    .form-container {
      max-width: 700px; margin: 2rem auto 0; padding: 2rem; border-radius: 15px;
      background: #fff; box-shadow: 0 4px 15px rgba(0,0,0,0.05);
      display: none; animation: fadeSlide 0.5s ease forwards;
    }
    @keyframes fadeSlide {
      from { opacity: 0; transform: translateY(-15px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .form-group { margin-bottom: 1.5rem; text-align: left; }
    label { font-weight: 600; margin-bottom: 8px; display: block; color: #145c4f; }
    input, select, textarea {
      width: 100%; padding: 12px; border: 1px solid #d1fae5; border-radius: 10px; font-size: 16px;
    }
    textarea { resize: none; height: 80px; }
    .submit-btn {
      background: #1b9c85; color: white; border: none; padding: 1rem;
      border-radius: 12px; font-size: 1.1rem; cursor: pointer; width: 100%;
    }
    .submit-btn:hover { background: #167b68; }

    /* Severity Slider */
    .slider {
      width: 100%;
      height: 10px;
      border-radius: 5px;
      background: linear-gradient(to right,
        #22c55e 0% 33.33%,
        #eab308 33.33% 66.66%,
        #f97316 66.66% 100%);
      outline: none;
      -webkit-appearance: none;
      appearance: none;
    }
    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px; height: 20px;
      border-radius: 50%;
      background: #22c55e;
      cursor: pointer;
      transition: background 0.3s;
    }
    .slider::-moz-range-thumb {
      width: 20px; height: 20px;
      border-radius: 50%;
      background: #22c55e;
      cursor: pointer;
      transition: background 0.3s;
    }
    .severity-labels {
      display: flex; justify-content: space-between;
      font-size: 0.9rem; margin-top: 8px;
    }

    /* Info Sections */
    .section { padding: 5rem 2rem; background: #f9fdfb; text-align: center; }
    .section h2 { font-size: 2rem; color: #145c4f; margin-bottom: 1rem; }
    .section p { max-width: 750px; margin: 0 auto; color: #444; font-size: 1.1rem; }

    /* Footer */
    footer { padding: 2rem; background: #145c4f; color: white; text-align: center; }
    footer a { color: #aef3e7; text-decoration: none; font-weight: 500; }
    footer a:hover { text-decoration: underline; }
    .credits { margin-top: 1rem; font-size: 0.9rem; color: #cfeee8; }

    .response-box {
      margin-top: 1rem;
      padding: 1rem;
      background: #f0fdf4;
      border-radius: 12px;
      color: #145c4f;
      min-height: 50px;
    }

  </style>
</head>
<body>
  <header>
    <div class="logo">Homedoctor.ai</div>
    <div class="menu-toggle" id="menu-toggle">☰</div>
    <nav id="nav">
      <a href="#coins">Coins</a>
      <a href="#checker">Checker</a>
      <a href="#about">About</a>
      <a href="login.html" id="logoutLink">Logout</a>
    </nav>
  </header>

  <!-- Hero -->
  <section class="hero">
    <div>
      <h1 id="welcomeText">Welcome!</h1>
      <p>Your personalized health dashboard, powered by AI.</p>
    </div>
  </section>

  <!-- Coins -->
  <section class="coins" id="coins">
    <h2>Your Coins</h2>
    <p>You currently have <b id="coins-count">--</b> coins left.</p>
    <button id="generateBtn" class="generate-btn">Generate Response</button>

    <!-- Hidden Form -->
    <div class="form-container" id="healthForm">
      <form id="symptomForm">
        <div class="form-group">
          <label>Name</label>
          <input type="text" id="name" placeholder="Your name" required>
        </div>
        <div class="form-group" style="display:flex; gap:1rem;">
          <div style="flex:1;">
            <label>Age</label>
            <input type="number" id="age" placeholder="e.g. 25" required>
          </div>
          <div style="flex:1;">
            <label>Gender</label>
            <select id="gender" required>
              <option value="">Select...</option>
              <option>Male</option>
              <option>Female</option>
              <option>Other</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label>Symptoms</label>
          <textarea id="symptoms" placeholder="Describe your symptoms..." required></textarea>
        </div>

        <!-- Severity Bar -->
        <div class="form-group">
          <label>Select Severity</label>
          <input type="range" min="1" max="3" value="1" id="severity" class="slider">
          <div class="severity-labels">
            <span style="color:#22c55e;">Mild</span>
            <span style="color:#eab308;">Moderate</span>
            <span style="color:#f97316;">Severe</span>
          </div>
          <p id="severityLabel" style="text-align:center; font-weight:bold; margin-top:10px; color:#22c55e;">Mild</p>
        </div>

        <div class="form-group">
          <label>Additional Details</label>
          <textarea id="details" placeholder="Any extra details about your health..."></textarea>
        </div>
        <button type="submit" class="submit-btn">Check My Health</button>
      </form>

      <div class="response-box" id="ai-response">Your AI Insights Will Appear Here...</div>
    </div>
  </section>

  <!-- Checker Info -->
  <section class="section" id="checker">
    <h2>AI Symptom Checker</h2>
    <p>Describe your symptoms and get AI-powered insights in seconds. Each response costs 20 coins.</p>
  </section>

  <!-- About -->
  <section class="section" id="about">
    <h2>About Homedoctor.ai</h2>
    <p>
      Homedoctor.ai helps you understand your health better with smart AI insights. 
      Manage your well-being, track improvements, and explore preventive care options — 
      all in one place.
    </p>
  </section>

  <footer>
    <p>Contact us at <a href="mailto:rizwanboss84@gmail.com">info@homedoctor.ai</a></p>
    <div class="credits">Made by Rizwan</div>
  </footer>

  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

    const supabaseUrl = "https://iklnmtdeqorwvufewddr.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlrbG5tdGRlcW9yd3Z1ZmV3ZGRyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5NTUwMTAsImV4cCI6MjA3MzUzMTAxMH0.93u-R49w8F4s3Y4jYYcSc7w-ZS14YGusNEO0uBwNTOs";
    const supabase = createClient(supabaseUrl, supabaseKey);

    const toggle = document.getElementById("menu-toggle");
    const nav = document.getElementById("nav");
    const generateBtn = document.getElementById("generateBtn");
    const healthForm = document.getElementById("healthForm");
    const severity = document.getElementById("severity");
    const severityLabel = document.getElementById("severityLabel");
    const coinsCount = document.getElementById("coins-count");
    const welcomeText = document.getElementById("welcomeText");
    const logoutLink = document.getElementById("logoutLink");
    const symptomForm = document.getElementById("symptomForm");
    const aiResponseBox = document.getElementById("ai-response");

    // Menu toggle
    toggle.addEventListener("click", () => nav.classList.toggle("active"));

    // Severity slider
    severity.addEventListener("input", () => {
      const val = severity.value;
      if(val==1){severityLabel.textContent="Mild";severityLabel.style.color="#22c55e";}
      else if(val==2){severityLabel.textContent="Moderate";severityLabel.style.color="#eab308";}
      else{severityLabel.textContent="Severe";severityLabel.style.color="#f97316";}
    });

    // Show/hide form
    generateBtn.addEventListener("click", () => {
      healthForm.style.display = healthForm.style.display==="block"?"none":"block";
    });

    // Load user + profile
    async function loadProfile(){
      const { data: { session } } = await supabase.auth.getSession();
      if(!session){ window.location.href="login.html"; return; }
      const user = session.user;
      const { data: profile } = await supabase.from("profiles").select("username,coins").eq("id",user.id).single();
      const username = profile?.username||user.email.split("@")[0];
      const coins = profile?.coins ?? 0;
      welcomeText.textContent = `Welcome, ${username}!`;
      coinsCount.textContent = coins;
    }

    // Logout
    logoutLink.addEventListener("click", async(e)=>{
      e.preventDefault();
      await supabase.auth.signOut();
      window.location.href="login.html";
    });

    // Handle form submit
    symptomForm.addEventListener("submit", async(e)=>{
      e.preventDefault();
      let coins = parseInt(coinsCount.textContent);
      if(coins<20){ alert("Not enough coins!"); return; }

      const name = document.getElementById("name").value;
      const age = document.getElementById("age").value;
      const gender = document.getElementById("gender").value;
      const symptoms = document.getElementById("symptoms").value;
      const details = document.getElementById("details").value;

      try{
        const res = await fetch("/api/ai-response.js",{
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body:JSON.stringify({name, age, gender, symptoms, severity:severityLabel.textContent, details})
        });
        const data = await res.json();
        if(data.message){
          coins -= 20;
          coinsCount.textContent = coins;
          aiResponseBox.textContent = data.message;
        } else aiResponseBox.textContent = "Error: "+(data.error||"Something went wrong");
      } catch(err){
        aiResponseBox.textContent = "Error: "+err.message;
      }

      loadProfile();
    });

    loadProfile();
  </script>
</body>
</html>
